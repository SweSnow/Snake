<link rel="import" href="../components/paper-dropdown/paper-dropdown-menu.html">
<link rel="import" href="../components/paper-ripple/paper-ripple.html">
<link rel="import" href="../components/core-ajax/core-ajax.html">

<link rel="import" href="../duarte-components/duarte-map.html">
<!-- <link rel="import" href="../duarte-components/duarte-maintainer.html"> -->

<polymer-element name="duarte-browse">
  <template>

	<style>

		:host {
			display: block;
			background-color: #efefef;
		}

		#header-container {
			padding-left: 48px;
			padding-right: 48px;
			background-color: #00695c;
			color: #fff;
			fill: #fff;
		}

		#header {
			margin: auto;
			max-width: 1100px;
			background-color: #00695c;
		}

		#maps-container {
			max-width: 1128px;
			margin-top: 32px;
			margin-left: auto;
			margin-right: auto;
		}

		.map {
			box-sizing: border-box;
			cursor: pointer;
			border-radius: 4px;
			background-color: #ffffff;
			width: 250px;
			height: 310px;
			position: relative;
			float: left;
			display: inline-block;
			transition: background-color 0.4s;
			margin: 16px;
			padding: 16px;
		}

		.map:active {
			background-color: #ddd;
		}

		.map-title {
			margin-top: 16px;
			font-weight: 300;
			color: #444;
			font-size: 1.7em;

			text-overflow: ellipsis;
			overflow: hidden;
			white-space: nowrap;
		}

		.map-creator {
			color: #444;
		}

		.map-ripple {
			color: #009688;
		}

		.duarte-thumbnail {
			width: 220px;
			height: 220px;
			position: absolute;
			left: 0;
			top: 0;
		}

		.rating-container {
			position: absolute;
			top: 0;
			right: 0;
			width: 48px;
			height: 48px;
			text-align: center;
			border-radius: 50%;
			padding-top: 14px;
			box-sizing: border-box;
			color: #fff;
			background-color: #009688;
		}

		.thumbnail-container {
			position: relative;
			height: 100%;
		}

		.subheader-dropdown-label  {
			margin-top: 34px;
			font-size: 0.8em;
		}

		.subheader-dropdown {
			width: 130px;
			margin-left: 32px;
			margin-top: 10px;
			color: #fff;
			fill: #fff;
			background-color: transparent;
		}

		.subheader-dropdown::shadow core-icon {
			fill: #fff;
		}

		.subheader-dropdown::shadow #control div {
			color: #fff;
			font-size: 0.8em;
		}	
		
		.subheader-dropdown::shadow #control {
			border-bottom: 1px solid #00695C;
		}	

		.subheader-dropdown /deep/ #ripple {
			color: #888;
		}

		#header > div > paper-dropdown-menu > paper-item {
			color: #333;
		}

		::selection {
			/*	#009688 with rgba 70% opacity: */;
			background-color: rgba(0, 150, 136, 0.7);
			color: #fff;
		}

		-moz-::selection {
			/*	#009688 with rgba 70% opacity: */;
			background-color: rgba(0, 150, 136, 0.7);
			color: #fff;
		}

	</style>
	
	<paper-shadow z="1" id="header-container">
		<core-toolbar id="header">

			<div class="bottom fit" horizontal layout>

				<div class="subheader-dropdown-label">Sort by:</div>
				<paper-dropdown-menu class="subheader-dropdown" on-core-select="{{onSortSelected}}" selected="Rating" valueattr="textContent">

					<paper-item data-sort="-rating">Rating</paper-item>
					<paper-item data-sort="-time">Newest</paper-item>
					<paper-item data-sort="time">Oldest</paper-item>
					
				</paper-dropdown-menu>
		  
			</div>

		</core-toolbar>
	</paper-shadow>

	<div id="maps-container">
		
		<template repeat="{{map in levels}}">
			<a is="pushstate-anchor" href="/play?levelId={{map._id}}">
				<paper-shadow z="1" vertical layout class="map" on-tap="{{mapClick}}">
					<paper-shadow z="1"></paper-shadow>
					<div class="thumbnail-container">
						<duarte-map grid="{{map.grid}}" class="duarte-thumbnail">
							<paper-ripple fit class="map-ripple"></paper-ripple>
						</duarte-map>
						<div class="rating-container">{{map.rating}}</div>
					</div>
					<div class="map-title">{{map.title}}</div>
					<div class="map-creator">{{map.creator.username}}</div>
				</paper-shadow>
			</a>
		</template>
	</div>

	<core-ajax
		id="get"
		method="get"
		auto="true"
		handleAs="json"
		response="{{levels}}"
		url="http://{{ip}}/level/all?sort={{sort}}"
		contentType="application/json"
		withCredentials="true"
		></core-ajax>

	<!-- <duarte-maintainer socket="{{socket}}" namespace="level" collection="{{levels}}"></duarte-maintainer> -->

  </template>
  <script>
	Polymer('duarte-browse', {
		sort: '-rating',
	  	mapClick: function() {

	  	},
	  	onSortSelected: function(e, detail) {
	  		if(detail.isSelected) {
		  		this.sort = detail.item.dataset.sort;
	  		}
	  	}
	  
	  //http://www.polymer-project.org/docs/elements/paper-elements.html#paper-dropdown
	  
	});
  </script>
</polymer-element>